<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive Chat</title>
</head>
<body>
  <h1>Interactive Chat</h1>
  <div id="chat">
    <div id="messages"></div>
    <input type="text" id="userInput" placeholder="Type a message..." />
    <button id="sendMessage">Send</button>
  </div>

  <script>
    const API_URL = '/api/chat'; // Serverless function endpoint
    const sessionId = 'chat-session'; // Key for localStorage

    // Retrieve chat history from localStorage
    function getChatHistory() {
      return JSON.parse(localStorage.getItem(sessionId)) || [];
    }

    // Store chat history in localStorage
    function saveChatHistory(history) {
      localStorage.setItem(sessionId, JSON.stringify(history));
    }

    // Display chat history
    function displayMessages(messages) {
      const messagesDiv = document.getElementById('messages');
      messagesDiv.innerHTML = messages.map(msg => `<p><strong>${msg.role}:</strong> ${msg.text}</p>`).join('');
    }

    // Handle sending messages
    document.getElementById('sendMessage').addEventListener('click', async () => {
      const input = document.getElementById('userInput').value;
      if (!input) return;

      // Retrieve and update chat history
      const history = getChatHistory();
      history.push({ role: 'user', text: input });
      saveChatHistory(history);

      // Send message and history to the serverless function
      const response = await fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: input, sessionId: sessionId, history: history }),
      });
      const result = await response.json();

      // Update chat history with model response
      history.push({ role: 'model', text: result.response });
      saveChatHistory(history);

      // Display updated messages
      displayMessages(history);

      // Clear input field
      document.getElementById('userInput').value = '';
    });

    // Initialize chat
    displayMessages(getChatHistory());
  </script>
</body>
</html>
